<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô | G-STORE</title>
    <link rel="stylesheet" href="style.css">
</head>

<body data-page="checkout">
    <!-- Top Info Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <a href="tel:021054757">üìû 02-105-4757</a>
                <a href="mailto:info@gstore.com">‚úâÔ∏è info@gstore.com</a>
            </div>
            <div class="top-bar-center">
                ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‚Äî G-STORE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏à‡∏™‡∏≤‡∏¢‡πÄ‡∏Å‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå
            </div>
            <div class="top-bar-right">
                <a href="#">üìç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì ‚Ä∫</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <div class="main-header">
        <div class="container">
            <div class="logo">
                <a href="index.html">G-<span class="logo-highlight">STORE</span></a>
            </div>
            <div class="search-bar">
                <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...">
                <button class="search-btn">üîç</button>
            </div>
            <div class="header-actions">
                <a href="login.html" id="login-btn" class="header-icon-btn">
                    <span class="icon">üë§</span>
                    <span id="user-display">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                </a>
                <a href="cart.html" class="header-icon-btn">
                    <span class="icon">üõí</span>
                    <span>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                    <span class="badge" id="cart-count">0</span>
                </a>
                <button id="logout-btn" onclick="logout()" class="btn btn-outline hidden">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <div class="container">
            <button class="category-dropdown-btn" onclick="window.location.href='index.html#categories'">
                ‚ò∞ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Ä∫
            </button>
            <ul class="nav-links">
                <li><a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                <li><a href="index.html#products">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a></li>
                <li><a href="index.html#categories">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</a></li>
                <li><a href="blog.html">‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°</a></li>
                <li><a href="contact.html">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a></li>
                <li><a href="about.html">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a></li>
            </ul>
        </div>
    </nav>

    <!-- Checkout Steps -->
    <div class="checkout-steps">
        <div class="container">
            <div class="step completed">
                <span class="step-num">‚úì</span>
                <span class="step-label">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
            </div>
            <div class="step-line"></div>
            <div class="step active">
                <span class="step-num">2</span>
                <span class="step-label">‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</span>
            </div>
            <div class="step-line"></div>
            <div class="step">
                <span class="step-num">3</span>
                <span class="step-label">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
            </div>
        </div>
    </div>

    <!-- Checkout Content -->
    <section class="checkout-section">
        <div class="container">
            <div class="checkout-grid">
                <!-- Left: Shipping & Payment -->
                <div class="checkout-left">
                    <!-- Shipping Info -->
                    <div class="checkout-card">
                        <h3>üì¶ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
                        <form id="checkout-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ship-name">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label>
                                    <input type="text" id="ship-name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
                                </div>
                                <div class="form-group">
                                    <label for="ship-phone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå <span class="required">*</span></label>
                                    <input type="tel" id="ship-phone" placeholder="08x-xxx-xxxx" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ship-address">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà <span class="required">*</span></label>
                                <textarea id="ship-address" rows="3" placeholder="‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏´‡∏°‡∏π‡πà ‡∏ã‡∏≠‡∏¢ ‡∏ñ‡∏ô‡∏ô"
                                    required></textarea>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ship-district">‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏• <span class="required">*</span></label>
                                    <input type="text" id="ship-district" placeholder="‡πÅ‡∏Ç‡∏ß‡∏á/‡∏ï‡∏≥‡∏ö‡∏•" required>
                                </div>
                                <div class="form-group">
                                    <label for="ship-amphoe">‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠ <span class="required">*</span></label>
                                    <input type="text" id="ship-amphoe" placeholder="‡πÄ‡∏Ç‡∏ï/‡∏≠‡∏≥‡πÄ‡∏†‡∏≠" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ship-province">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î <span class="required">*</span></label>
                                    <input type="text" id="ship-province" placeholder="‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" required>
                                </div>
                                <div class="form-group">
                                    <label for="ship-zipcode">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå <span class="required">*</span></label>
                                    <input type="text" id="ship-zipcode" placeholder="10xxx" required maxlength="5"
                                        pattern="[0-9]{5}">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ship-note">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)</label>
                                <input type="text" id="ship-note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡πà‡∏á‡∏ä‡πà‡∏ß‡∏á‡∏ö‡πà‡∏≤‡∏¢, ‡∏ù‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ">
                            </div>
                        </form>
                    </div>

                    <!-- Payment Method -->
                    <div class="checkout-card">
                        <h3>üí≥ ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                        <div class="payment-methods">
                            <label class="payment-option selected" id="pay-transfer">
                                <input type="radio" name="payment" value="transfer" checked>
                                <div class="payment-content">
                                    <span class="payment-icon">üè¶</span>
                                    <div>
                                        <strong>‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£</strong>
                                        <small>‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ</small>
                                    </div>
                                </div>
                            </label>
                            <label class="payment-option" id="pay-promptpay">
                                <input type="radio" name="payment" value="promptpay">
                                <div class="payment-content">
                                    <span class="payment-icon">üì±</span>
                                    <div>
                                        <strong>PromptPay / QR Code</strong>
                                        <small>‡∏™‡πÅ‡∏Å‡∏ô QR Code ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</small>
                                    </div>
                                </div>
                            </label>
                            <label class="payment-option" id="pay-cod">
                                <input type="radio" name="payment" value="cod">
                                <div class="payment-content">
                                    <span class="payment-icon">üì¶</span>
                                    <div>
                                        <strong>‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)</strong>
                                        <small>‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</small>
                                    </div>
                                </div>
                            </label>
                            <label class="payment-option" id="pay-credit">
                                <input type="radio" name="payment" value="credit">
                                <div class="payment-content">
                                    <span class="payment-icon">üí≥</span>
                                    <div>
                                        <strong>‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï / ‡πÄ‡∏î‡∏ö‡∏¥‡∏ï</strong>
                                        <small>VISA, MasterCard, JCB</small>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Right: Order Summary -->
                <div class="checkout-right">
                    <div class="checkout-card order-summary-card">
                        <h3>üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h3>
                        <div id="checkout-items">
                            <!-- Items loaded by JS -->
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-row">
                            <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                            <span id="summary-subtotal">‡∏ø0</span>
                        </div>
                        <div class="summary-row">
                            <span>‡∏Ñ‡πà‡∏≤‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</span>
                            <span id="summary-shipping" class="shipping-free">‡∏ü‡∏£‡∏µ</span>
                        </div>
                        <div class="summary-row discount-row hidden" id="discount-row">
                            <span>‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</span>
                            <span id="summary-discount">-‡∏ø0</span>
                        </div>
                        <div class="summary-divider"></div>
                        <div class="summary-row total-row">
                            <span>‡∏¢‡∏≠‡∏î‡∏ä‡∏≥‡∏£‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                            <span id="summary-total">‡∏ø0</span>
                        </div>
                        <button id="place-order-btn" class="btn btn-primary place-order-btn" onclick="placeOrder()">
                            ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                        </button>
                        <a href="cart.html" class="back-to-cart">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-bottom">
            <div class="container">
                <p>&copy; 2026 G-STORE Gaming. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="app.js"></script>
    <script>
        // Load checkout items
        document.addEventListener('DOMContentLoaded', () => {
            loadCheckoutSummary();
            setupPaymentMethods();
        });

        function loadCheckoutSummary() {
            const itemsContainer = document.getElementById('checkout-items');
            const subtotalEl = document.getElementById('summary-subtotal');
            const totalEl = document.getElementById('summary-total');

            if (cart.length === 0) {
                window.location.href = 'cart.html';
                return;
            }

            let total = 0;
            itemsContainer.innerHTML = cart.map(item => {
                const itemTotal = parseFloat(item.price) * item.quantity;
                total += itemTotal;
                return `
                    <div class="summary-item">
                        <img src="${item.image_url}" alt="${item.name}" class="summary-item-img"
                             onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 60 60%22><rect fill=%22%23f5f5f5%22 width=%2260%22 height=%2260%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22%23ccc%22 font-size=%2220%22>üì¶</text></svg>'">
                        <div class="summary-item-info">
                            <span class="summary-item-name">${item.name}</span>
                            <span class="summary-item-qty">x${item.quantity}</span>
                        </div>
                        <span class="summary-item-price">‡∏ø${itemTotal.toLocaleString()}</span>
                    </div>`;
            }).join('');

            subtotalEl.textContent = `‡∏ø${total.toLocaleString()}`;
            totalEl.textContent = `‡∏ø${total.toLocaleString()}`;
        }

        function setupPaymentMethods() {
            document.querySelectorAll('.payment-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    document.querySelectorAll('.payment-option').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                });
            });
        }

        async function placeOrder() {
            if (!user) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
                window.location.href = 'login.html';
                return;
            }

            // Validate form
            const form = document.getElementById('checkout-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const btn = document.getElementById('place-order-btn');
            btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...';
            btn.disabled = true;

            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;

            const orderData = {
                user_id: user.id,
                items: cart,
                shipping: {
                    name: document.getElementById('ship-name').value,
                    phone: document.getElementById('ship-phone').value,
                    address: document.getElementById('ship-address').value,
                    district: document.getElementById('ship-district').value,
                    amphoe: document.getElementById('ship-amphoe').value,
                    province: document.getElementById('ship-province').value,
                    zipcode: document.getElementById('ship-zipcode').value,
                    note: document.getElementById('ship-note').value
                },
                payment_method: paymentMethod
            };

            try {
                const response = await fetch(`${API_URL}/orders.php`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(orderData)
                });

                const result = await response.json();

                if (response.ok) {
                    cart = [];
                    saveCart();
                    // Show success
                    document.querySelector('.checkout-section').innerHTML = `
                        <div class="container">
                            <div class="order-success">
                                <div class="success-icon">üéâ</div>
                                <h2>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
                                <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ G-STORE</p>
                                <p class="order-id-text">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: <strong>#${result.order_id || '---'}</strong></p>
                                <div class="success-actions">
                                    <a href="orders.html" class="btn btn-primary">üìã ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</a>
                                    <a href="index.html" class="btn btn-outline">üè† ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                                </div>
                            </div>
                        </div>`;
                    // Update steps
                    document.querySelectorAll('.step').forEach(s => s.classList.add('completed'));
                    document.querySelectorAll('.step')[2].classList.add('active');
                } else {
                    alert(result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                }
            } catch (error) {
                console.error('Order error:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
            } finally {
                btn.disabled = false;
                btn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠';
            }
        }
    </script>
</body>

</html>