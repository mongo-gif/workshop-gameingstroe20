<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | G-STORE</title>
    <link rel="stylesheet" href="style.css">
</head>

<body data-page="category">
    <!-- Top Info Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-left">
                <a href="tel:0924416570">üìû 092-441-6570</a>
                <a href="mailto:zezggez@gmail.com">‚úâÔ∏è zezggez@gmail.com</a>
            </div>
            <div class="top-bar-center">
                ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏ä‡∏≠‡∏ö‡πÄ‡∏Å‡∏°‡∏°‡∏¥‡πà‡∏á‡πÄ‡∏Å‡∏µ‡∏¢‡∏£‡πå ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô ‚Äî G-STORE ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏£‡∏π‡πâ‡πÉ‡∏à‡∏™‡∏≤‡∏¢‡πÄ‡∏Å‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå
            </div>
            <div class="top-bar-right">
                <a href="#">üìç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì ‚Ä∫</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <div class="main-header">
        <div class="container">
            <div class="logo">
                <a href="index.html">G-<span class="logo-highlight">STORE</span></a>
            </div>
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..."
                    onkeydown="if(event.key==='Enter')searchInCategory()">
                <button class="search-btn" onclick="searchInCategory()">üîç</button>
            </div>
            <div class="header-actions">
                <a href="login.html" id="login-btn" class="header-icon-btn">
                    <span class="icon">üë§</span>
                    <span id="user-display">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                </a>
                <a href="cart.html" class="header-icon-btn">
                    <span class="icon">üõí</span>
                    <span>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</span>
                    <span class="badge" id="cart-count">0</span>
                </a>
                <button id="logout-btn" onclick="logout()" class="btn btn-outline hidden">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </div>
    </div>

    <!-- Navigation Bar -->
    <nav class="nav-bar">
        <div class="container">
            <button class="category-dropdown-btn" onclick="window.location.href='category.html'">
                ‚ò∞ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‚Ä∫
            </button>
            <ul class="nav-links">
                <li><a href="index.html">‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a></li>
                <li><a href="index.html#products">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a></li>
                <li><a href="category.html" class="active">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</a></li>
                <li><a href="blog.html">‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°</a></li>
                <li><a href="contact.html">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</a></li>
                <li><a href="about.html">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤</a></li>
            </ul>
        </div>
    </nav>

    <!-- Breadcrumb -->
    <div class="breadcrumb-section">
        <div class="container">
            <nav class="breadcrumb">
                <a href="index.html">üè† ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</a>
                <span class="breadcrumb-sep">‚Ä∫</span>
                <span id="breadcrumb-cat" class="breadcrumb-current">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
            </nav>
        </div>
    </div>

    <!-- Category Content -->
    <section class="page-section">
        <div class="container">
            <!-- Category Sidebar + Products Grid -->
            <div class="category-page-grid">
                <!-- Category Sidebar -->
                <aside class="category-sidebar">
                    <h3>üìÇ ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <ul id="category-sidebar-list"></ul>
                </aside>

                <!-- Products Area -->
                <div class="category-products-area">
                    <div class="category-products-header">
                        <h2 id="category-title">
                            <span id="cat-icon">üì¶</span>
                            <span id="cat-name">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                        </h2>
                        <span id="cat-count" class="cat-product-count">0 ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                    </div>
                    <div id="products-grid" class="products-grid">
                        <div class="loading">
                            <div class="spinner"></div>
                            <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-bottom">
            <div class="container">
                <p>&copy; 2026 G-STORE Gaming. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="app.js"></script>
    <script>
        let allCategoryProducts = [];
        const urlParams = new URLSearchParams(window.location.search);
        let currentCat = urlParams.get('cat') || 'all';

        document.addEventListener('DOMContentLoaded', () => {
            renderSidebar();
            loadCategoryProducts();
        });

        function renderSidebar() {
            const list = document.getElementById('category-sidebar-list');
            list.innerHTML = categories.map(cat => `
                <li>
                    <a href="category.html?cat=${cat.id}" 
                       class="sidebar-cat-link ${currentCat === cat.id ? 'active' : ''}">
                        <span class="sidebar-cat-icon">${cat.icon}</span>
                        <span>${cat.name}</span>
                    </a>
                </li>
            `).join('');
        }

        async function loadCategoryProducts() {
            try {
                const response = await fetch(`${API_URL}/products.php`);
                allCategoryProducts = await response.json();
                products = allCategoryProducts; // for addToCart to work

                filterCategory(currentCat);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('products-grid').innerHTML = `
                    <div class="empty-state" style="grid-column:1/-1">
                        <span class="empty-icon">üòï</span>
                        <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏î‡πâ</p>
                        <button class="btn btn-primary" onclick="loadCategoryProducts()">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
                    </div>`;
            }
        }

        function filterCategory(catId) {
            currentCat = catId;
            const cat = categories.find(c => c.id === catId);

            // Update UI
            document.getElementById('cat-icon').textContent = cat ? cat.icon : 'üì¶';
            document.getElementById('cat-name').textContent = cat ? cat.name : catId;
            document.getElementById('breadcrumb-cat').textContent = cat ? cat.name : '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
            document.title = `${cat ? cat.name : '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'} | G-STORE`;

            // Filter products
            let filtered;
            if (catId === 'all') {
                filtered = [...allCategoryProducts];
            } else {
                filtered = allCategoryProducts.filter(p => p.category === catId);
            }

            document.getElementById('cat-count').textContent = `${filtered.length} ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤`;

            // Update sidebar active state
            document.querySelectorAll('.sidebar-cat-link').forEach(link => {
                link.classList.remove('active');
                if (link.href.includes(`cat=${catId}`)) {
                    link.classList.add('active');
                }
            });

            // Update URL without reload
            const newUrl = `category.html?cat=${catId}`;
            window.history.replaceState({}, '', newUrl);

            renderProducts(filtered);
        }

        function searchInCategory() {
            const input = document.getElementById('search-input');
            const query = input.value.trim().toLowerCase();
            if (!query) {
                filterCategory(currentCat);
                return;
            }

            let base = currentCat === 'all' ? allCategoryProducts : allCategoryProducts.filter(p => p.category === currentCat);
            const results = base.filter(p =>
                p.name.toLowerCase().includes(query) ||
                (p.description && p.description.toLowerCase().includes(query))
            );

            document.getElementById('cat-count').textContent = `${results.length} ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏à‡∏≤‡∏Å "${input.value.trim()}"`;
            renderProducts(results);
        }
    </script>
</body>

</html>